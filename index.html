<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Quest VR – Move + Grab + Highlight (smooth turn)</title>

  <!-- A-Frame 1.7.0 -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

  <!-- éviter le conflit de nom "grabbable" avec super-hands -->
  <script> if (AFRAME.components && AFRAME.components.grabbable) { delete AFRAME.components.grabbable; } </script>

  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.2/dist/aframe-extras.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@c-frame/aframe-physics-system@4.1.0/dist/aframe-physics-system.min.js"></script>

  <script src="https://unpkg.com/super-hands@3.0.5/dist/super-hands.min.js"></script>

  <style>
    body {
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif
    }

    .overlay {
      position:fixed;
      left:12px;
      top:12px;
      z-index:9;
      background:#0009;
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      font-size:14px;
      line-height:1.35
    }

    .overlay kbd {
      background:#222;
      padding:2px 6px;
      border-radius:6px
    }  
  </style>

  <script src="./script.js"></script>


</head>
<body>
  <div class="overlay">
    <strong>Commandes Quest</strong><br/>
    Stick gauche : se déplacer • Stick droit : rotation<br/>
    Lasers par défaut • Trigger : grab / drop<br/>
    Spawn objet : bouton <b>A</b> (droite) ou <kbd>N</kbd> (clavier)
  </div>

<a-scene
  background="color:#20252b"
  renderer="colorManagement:true;physicallyCorrectLights:true;antialias:true;sortTransparentObjects:true"
  shadow="type:pcfsoft"
  physics="gravity:-9.8;debug:false"
  vr-mode-ui="enabled:true"
>
  <a-assets>
  <a-asset-item id="pistolModel" src="./blaster-a.glb"></a-asset-item>
  <audio id="hitSnd" src="./hit.ogg" preload="auto"></audio>
  <img id="spark" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="/>
</a-assets>



  <!-- lumières -->
  <a-entity light="type:ambient; intensity:0.35; color:#ffffff"></a-entity>
  <a-entity light="type:directional; intensity:1; castShadow:true" position="2 6 3" rotation="-45 30 0"></a-entity>

  <!-- sol -->
  <a-plane rotation="-90 0 0" width="50" height="50"
           color="#25cc51" material="roughness:1; metalness:0"
           shadow="receive:true" static-body></a-plane>

  <!-- RIG + caméra -->
  <a-entity id="rig" position="0 1.6 3">
    <a-entity id="cam" camera look-controls wasd-controls="enabled:false"></a-entity>

<!-- MAIN GAUCHE -->
<a-entity id="leftCtl"
  oculus-touch-controls="hand: left"
  left-stick-move="rig:#rig; speed:2.2; dead:0.18"
  laser-controls="hand: left"
  raycaster="objects:.grab-target:not(.held); showLine:true; far:8; interval:0"
  laser-hover
  raycast-collider-proxy
  static-body="shape: sphere; sphereRadius: 0.04"
  desktop-grab-keys="key: e"
  super-hands="
    colliderEvent: hitstart;
    colliderEndEvent: hitend;
    colliderEventProperty: els;
    grabStartButtons: triggerdown, selectstart, keyEdown;
    grabEndButtons:   triggerup,   selectend,   keyEup">
</a-entity>

<!-- MAIN DROITE -->
<a-entity id="rightCtl"
  oculus-touch-controls="hand: right"
  right-stick-smoothturn="rig:#rig; speedDeg:140; dead:0.18"
  laser-controls="hand: right"
  raycaster="objects:.grab-target:not(.held); showLine:true; far:8; interval:0"
  laser-hover
  raycast-collider-proxy
  static-body="shape: sphere; sphereRadius: 0.04"
  desktop-grab-keys="key: e"
  super-hands="
    colliderEvent: hitstart;
    colliderEndEvent: hitend;
    colliderEventProperty: els;
    grabStartButtons: triggerdown, selectstart, keyEdown;
    grabEndButtons:   triggerup,   selectend,   keyEup"

  front-spawn="camera:#cam; dist:1.4; yOffset:0.35">
</a-entity>






  </a-entity>

<!-- TABLE -->
<a-box id="tableTop"
       position="0 1.2 -1.6"
       width="5" height="0.14" depth="2.8"
       color="#8B5A2B"
       static-body
       shadow="cast:true;receive:true"></a-box>

<!-- Pieds adaptés -->
<a-box position="-2.35 0.6 -2.9" width="0.14" height="1.2" depth="0.14" color="#6E4A20" static-body shadow></a-box>
<a-box position=" 2.35 0.6 -2.9" width="0.14" height="1.2" depth="0.14" color="#6E4A20" static-body shadow></a-box>
<a-box position="-2.35 0.6 -0.3" width="0.14" height="1.2" depth="0.14" color="#6E4A20" static-body shadow></a-box>
<a-box position=" 2.35 0.6 -0.3" width="0.14" height="1.2" depth="0.14" color="#6E4A20" static-body shadow></a-box>





  <!-- Spawner indépendant (spawn unique au load) -->
  <a-entity table-spawn></a-entity>

  <a-entity spawn-targets="intervalMs:2000; maxActive:5; minX:-3; maxX:3; minZ:-4; maxZ:-1.0; baseY:1.5"></a-entity>


  <a-sky color="#55dbed"></a-sky>
</a-scene>

</body>
</html>
